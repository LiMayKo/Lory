<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Page</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="shortcut icon" href="images/longciomay.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
  <!-- Navbar for Hi Admin! and Logout dropdown -->
  <nav class="navbar navbar-light ">
    <span class="navbar-text mr-auto">
      Hi Admin!
    </span>
    <div class="dropdown">
      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Settings
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <a class="dropdown-item" id="logout-btn" href="#">Logout</a>
      </div>
    </div>
  </nav>



  <div class="container-fluid">
    <div class="row">
      <!-- Side Navbar -->
      <div class="col-md-3">
        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
          <a class="nav-link active" id="dashboard-tab" data-toggle="pill" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="true">Dashboard</a>
          <a class="nav-link" id="data-entry-tab" data-toggle="pill" href="#data-entry" role="tab" aria-controls="data-entry" aria-selected="false">Data Entry</a>
          <a class="nav-link" id="transactions-tab" data-toggle="pill" href="#transactions" role="tab" aria-controls="transactions" aria-selected="false">Transactions</a>
          <a class="nav-link" id="notifications-tab" data-toggle="pill" href="#notifications" role="tab" aria-controls="notifications" aria-selected="false">Notifications</a>
          <a class="nav-link" id="reports-tab" data-toggle="pill" href="#reports" role="tab" aria-controls="reports" aria-selected="false">Reports</a>
          <a class="nav-link" id="settings-tab" data-toggle="pill" href="#settings" role="tab" aria-controls="settings" aria-selected="false">Settings</a>
        </div>
      </div>
      
      <!-- Main Content -->
      <div class="col-md-9">
        <div class="tab-content" id="v-pills-tabContent">
          <!-- Dashboard Section -->
          <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
            <h2 class="text-center mt-5">Dashboard</h2>
            <!-- Add your dashboard content here (e.g., total orders, total purchases, statistics, graphs, etc.) -->
          </div>

          <!-- Data Entry Section -->
          <div class="tab-pane fade" id="data-entry" role="tabpanel" aria-labelledby="data-entry-tab">
            <h2 class="text-center mt-5">Data Entry</h2>
              <div id="employee-form" class="mt-4">
                <!-- Button to open modal for adding new employee -->
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addEmployeeModal">
                  Add New Employee
                </button>
              </div>
                        <!-- Table for displaying existing employees -->
                <div id="employee-table" class="mt-4">
                  <h4 class="text-center">Existing Employees</h4>
                  <div class="table-responsive">
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th scope="col">Full Name</th>
                          <th scope="col">Role</th>
                          <th scope="col">Actions</th>
                        </tr>
                      </thead>
                      <tbody id="employee-table-body">
                        <!-- Table rows will be dynamically populated with employee data -->
                      </tbody>
                    </table>
                  </div>
                </div>
                <!-- Modal for employee deletion confirmation -->
                  <div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Deletion</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          Are you sure you want to delete this employee?
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                          <button type="button" class="btn btn-danger" id="confirm-delete-btn">Yes, delete</button>
                        </div>
                      </div>
                    </div>
                  </div>
          </div>
        <!-- TRANSACTIONS -->
                  <div class="tab-pane fade" id="transactions" role="tabpanel" aria-labelledby="transactions-tab">
                    <h2 class="text-center mt-5">Transactions</h2>
                    <!-- Add your dashboard content here (e.g., total orders, total purchases, statistics, graphs, etc.) -->
                  </div>
        <!-- TRANSACTIONS -->

        <!-- NOTIFICATIONS -->
                  <div class="tab-pane fade" id="notifications" role="tabpanel" aria-labelledby="notifications-tab">
                    <h2 class="text-center mt-5">NOTIFICATIONS</h2>
                    <!-- Add your dashboard content here (e.g., total orders, total purchases, statistics, graphs, etc.) -->
                  </div>
        <!-- NOTIFICATIONS -->

        <!-- REPORTS -->
                  <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="reports-tab">
                    <h2 class="text-center mt-5">REPORTS</h2>
                    <!-- Add your dashboard content here (e.g., total orders, total purchases, statistics, graphs, etc.) -->
                  </div>
        <!-- REPORTS -->

        <!-- SETTINGS -->
                  <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                    <h2 class="text-center mt-5">SETTINGS</h2>
                    <!-- Add your dashboard content here (e.g., total orders, total purchases, statistics, graphs, etc.) -->
                  </div>
        <!-- SETTINGS -->



        </div>
      </div>
    </div>
  </div>

  <!-- Modal for adding new employee -->
<div class="modal fade" id="addEmployeeModal" tabindex="-1" role="dialog" aria-labelledby="addEmployeeModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addEmployeeModalLabel">Add New Employee</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Form for adding a new employee -->
        <div class="form-group">
          <label for="employee-name">Name</label>
          <input type="text" class="form-control" id="employee-name" required>
        </div>
        <div class="form-group">
          <label for="employee-middle-name">Middle Name</label>
          <input type="text" class="form-control" id="employee-middle-name">
        </div>
        <div class="form-group">
          <label for="employee-last-name">Last Name</label>
          <input type="text" class="form-control" id="employee-last-name" required>
        </div>
        <div class="form-group">
          <label for="employee-role">Role</label>
          <select class="form-control" id="employee-role" required>
            <option value="Customer">Customer (Ordering/Menu)</option>
            <option value="Cashier">Cashier</option>
            <option value="Cook">Cook</option>
            <option value="Admin">Admin</option>
          </select>
        </div>
        <div class="form-group">
          <label for="employee-contact">Contact Number</label>
          <input type="number" class="form-control" id="employee-contact" required>
        </div>
        <div class="form-group">
          <label for="employee-address">Address</label>
          <input type="text" class="form-control" id="employee-address" required>
        </div>
        <div class="form-group">
          <label for="employee-email">Email</label>
          <input type="email" class="form-control" id="employee-email" required>
        </div>
        <div class="form-group">
          <label for="employee-password">Password</label>
          <input type="password" class="form-control" id="employee-password" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="save-add-employee-btn-modal">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal for displaying employee details -->
<div class="modal fade" id="employeeDetailsModal" tabindex="-1" role="dialog" aria-labelledby="employeeDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="employeeDetailsModalLabel">Employee Details</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="employeeDetailsBody">
<!-- Form for displaying and editing employee details -->
<form id="editEmployeeForm">
  <div class="form-group">
    <label for="employee-id">Employee ID</label>
    <input type="text" class="form-control" id="employee-id-view" readonly>
  </div>

  <div class="form-group">
    <label for="employee-name">Name</label>
    <input type="text" class="form-control" id="employee-name-view" required>
  </div>
  <div class="form-group">
    <label for="employee-middle-name">Middle Name</label>
    <input type="text" class="form-control" id="employee-middle-name-view">
  </div>
  <div class="form-group">
    <label for="employee-last-name">Last Name</label>
    <input type="text" class="form-control" id="employee-last-name-view" required>
  </div>
  <div class="form-group">
    <label for="employee-role">Role</label>
    <select class="form-control" id="employee-role-view" required>
      <option value="Customer">Customer (Ordering/Menu)</option>
      <option value="Cashier">Cashier</option>
      <option value="Cook">Cook</option>
      <option value="Admin">Admin</option>
    </select>
  </div>
  <div class="form-group">
    <label for="employee-contact">Contact Number</label>
    <input type="number" class="form-control" id="employee-contact-view" required>
  </div>
  <div class="form-group">
    <label for="employee-address">Address</label>
    <input type="text" class="form-control" id="employee-address-view" required>
  </div>
  <div class="form-group">
    <label for="employee-email">Email</label>
    <input type="email" class="form-control" id="employee-email-view" required>
  </div>
    <!-- Add password field with eye icon -->
  <div class="form-group">
    <label for="employee-password-view">Password</label>
    <div class="input-group">
      <input type="password" class="form-control" id="employee-password-view" >
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" type="button" id="toggle-password">
          <i class="fa fa-eye"></i>
        </button>
      </div>
    </div>
  </div>
  <!-- End of password field -->
  <button type="button" class="btn btn-primary" id="save-edit-employee-btn-view">Save</button>
</form>





<!-- Your HTML code remains unchanged -->

<!-- Bootstrap and Firebase Scripts -->
<script type="module" src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script type="module" src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Your HTML code remains unchanged -->

<!-- Firebase Auth Script -->
<script type="module" src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js"></script>

<script type="module">
    // Import Firebase authentication functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";
    import { getDoc } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";
    import { updateDoc } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";


const firebaseConfig = {
    apiKey: "AIzaSyDT4iaPdleCjt7K2AYVDfEaZOi6UqDHCDU",
    authDomain: "lory-c64ec.firebaseapp.com",
    projectId: "lory-c64ec",
    storageBucket: "lory-c64ec.appspot.com",
    messagingSenderId: "371071401749",
    appId: "1:371071401749:web:f5f5ef959488fcfd78b31c",
    measurementId: "G-TXBTQ3L6XE"
  };
// Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const firestore = getFirestore(app);


// Function to display existing employees in the table
const displayEmployees = async () => {
    const employeeTableBody = document.getElementById('employee-table-body');

    try {
        // Retrieve existing employees from Firestore
        const querySnapshot = await getDocs(collection(firestore, 'employees'));

        // Clear existing table rows
        employeeTableBody.innerHTML = '';

        // Populate table with employee data
querySnapshot.forEach((doc) => {
    const employee = doc.data();
    const row = `
        <tr id="${doc.id}" class="employee-row">
            <!-- Remove the <td> for Employee ID -->
            <td>${employee.name} ${employee.middleName} ${employee.lastName}</td>
            <td>${employee.role}</td>
            <td>
                <button type="button" class="btn btn-primary edit-btn">Edit</button> <!-- Added Edit button -->
                <button type="button" class="btn btn-danger delete-btn">Delete</button>

            </td>
        </tr>
    `;
    employeeTableBody.innerHTML += row;
});


      
  // Attach event listeners to each delete button
  const deleteButtons = document.querySelectorAll('.delete-btn');
  deleteButtons.forEach((button) => {
    button.addEventListener('click', async () => {
      const employeeId = button.parentElement.parentElement.id;
      console.log('Clicked delete button for employee ID:', employeeId);
      
      // Show confirmation modal
      $('#confirmDeleteModal').modal('show');

      // Attach event listener to confirm deletion
      document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
        // Delete employee only if confirmed
        await deleteEmployee(employeeId);
        // Close the confirmation modal
        $('#confirmDeleteModal').modal('hide');
      });
    });
  });

        // Attach event listeners to each edit button
    const editButtons = document.querySelectorAll('.edit-btn');
    editButtons.forEach((button) => {
        button.addEventListener('click', async () => {
            const employeeId = button.parentElement.parentElement.id;
            console.log('Clicked edit button for employee ID:', employeeId);

            // Retrieve employee details and open edit modal
            await openEditModal(employeeId);
        });
    });


    } catch (error) {
        console.error("Error displaying employees:", error);
    }
};

// Attach event listener for the delete button outside the displayEmployees() function
document.addEventListener('click', async (event) => {
    const target = event.target;
    if (target.classList.contains('delete-btn')) {
        const employeeId = target.parentElement.parentElement.id;
        console.log('Clicked delete button for employee ID:', employeeId);

        // Show confirmation modal
        $('#confirmDeleteModal').modal('show');

        // Attach event listener to confirm deletion
        document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
            // Delete employee only if confirmed
            await deleteEmployee(employeeId);
            // Close the confirmation modal
            $('#confirmDeleteModal').modal('hide');
        });
    }
});

const openEditModal = async (employeeId) => {
    try {
        const docSnapshot = await getDoc(doc(firestore, 'employees', employeeId));
        const employee = docSnapshot.data();
        
        // Populate the modal body with employee details
        document.getElementById('employee-id-view').value = employeeId; // Set the Firestore document ID in the modal
        document.getElementById('employee-name-view').value = employee.name;
        document.getElementById('employee-middle-name-view').value = employee.middleName;
        document.getElementById('employee-last-name-view').value = employee.lastName;
        document.getElementById('employee-role-view').value = employee.role;
        document.getElementById('employee-contact-view').value = employee.contact;
        document.getElementById('employee-address-view').value = employee.address;
        document.getElementById('employee-email-view').value = employee.email;
        document.getElementById('employee-password-view').value = employee.password; // Populate the password field

        // Display the modal
        $('#employeeDetailsModal').modal('show');
    } catch (error) {
        console.error("Error getting employee details:", error);
    }
};


// Function to add a new employee to Firestore
const addEmployee = async (name, middleName, lastName, role, contact, address, email, password) => {
    try {
        // Add employee to Firestore
        await addDoc(collection(firestore, 'employees'), {
            name: name,
            middleName: middleName,
            lastName: lastName,
            role: role,
            contact: contact,
            address: address,
            email: email,
            password: password // Include password field
        });

        // Create a new user account with email and password using Firebase Authentication
        await createUserWithEmailAndPassword(auth, email, password);

        console.log('Employee added successfully');
        // Refresh the table to reflect the changes
        displayEmployees();
    } catch (error) {
        console.error('Error adding employee:', error);
    }
};



const updateEmployee = async (employeeId, name, middleName, lastName, role, contact, address, email, password) => {
    try {
        const employeeRef = doc(firestore, 'employees', employeeId);
        const employeeSnapshot = await getDoc(employeeRef);
        
        // Check if the document exists before updating
        if (employeeSnapshot.exists()) {
            // Update employee document in Firestore
            await updateDoc(employeeRef, {
                name: name,
                middleName: middleName,
                lastName: lastName,
                role: role,
                contact: contact,
                address: address,
                email: email,
                password: password // Include password field in update
            });

            console.log('Employee updated successfully:', employeeId);
        } else {
            console.error('Employee document not found:', employeeId);
        }
    } catch (error) {
        console.error('Error updating employee:', error);
    }
};

// Function to delete employee from Firestore
const deleteEmployee = async (employeeId) => {
    try {
        // Delete employee document from Firestore
        await deleteDoc(doc(firestore, 'employees', employeeId));
        console.log('Employee deleted successfully');
        
        // Refresh the table to reflect the changes
        displayEmployees();
    } catch (error) {
        console.error("Error deleting employee:", error);
    }
};
window.onload = () => {
    displayEmployees();


      // Check authentication state when the page loads
    onAuthStateChanged(auth, (user) => {
        if (!user) {
            // If user is not logged in, redirect to login page
            window.location.href = 'index.html';
        }
    });

    // Logout button event listener
    document.getElementById('logout-btn').addEventListener('click', async () => {
        try {
            // Sign out the user
            await signOut(auth);
            // Redirect to login page
            window.location.href = 'index.html';
        } catch (error) {
            console.error('Error signing out:', error);
        }
    });
};

// Event listener for save button in addEmployeeModal
document.getElementById('save-add-employee-btn-modal').addEventListener('click', async () => {
    try {
        const name = document.getElementById('employee-name').value.trim();
        const middleName = document.getElementById('employee-middle-name').value.trim();
        const lastName = document.getElementById('employee-last-name').value.trim();
        const role = document.getElementById('employee-role').value.trim();
        const contact = document.getElementById('employee-contact').value.trim();
        const address = document.getElementById('employee-address').value.trim();
        const email = document.getElementById('employee-email').value.trim();
        const password = document.getElementById('employee-password').value.trim(); // Capture password input value

        // Add new employee to Firestore with password
        await addEmployee(name, middleName, lastName, role, contact, address, email, password);

        // Close the modal
        $('#addEmployeeModal').modal('hide');

        // Clear form fields
        document.getElementById('employee-name').value = '';
        document.getElementById('employee-middle-name').value = '';
        document.getElementById('employee-last-name').value = '';
        document.getElementById('employee-role').value = '';
        document.getElementById('employee-contact').value = '';
        document.getElementById('employee-address').value = '';
        document.getElementById('employee-email').value = '';
        document.getElementById('employee-password').value = ''; // Clear password input
    } catch (error) {
        console.error('Error saving employee:', error);
    }
});

document.getElementById('save-edit-employee-btn-view').addEventListener('click', async () => {
    try {
        // Retrieve input values from the modal
        const employeeId = document.getElementById('employee-id-view').value.trim();
        const name = document.getElementById('employee-name-view').value.trim();
        const middleName = document.getElementById('employee-middle-name-view').value.trim();
        const lastName = document.getElementById('employee-last-name-view').value.trim();
        const role = document.getElementById('employee-role-view').value.trim();
        const contact = document.getElementById('employee-contact-view').value.trim();
        const address = document.getElementById('employee-address-view').value.trim();
        const email = document.getElementById('employee-email-view').value.trim();
        const password = document.getElementById('employee-password-view').value.trim(); // Retrieve updated password

        // Update employee details in Firestore, including password
        await updateEmployee(employeeId, name, middleName, lastName, role, contact, address, email, password);

        // Close the modal
        $('#employeeDetailsModal').modal('hide');

        // Refresh the table to reflect the changes
        displayEmployees(); // Call the displayEmployees function
    } catch (error) {
        console.error('Error saving employee details:', error);
    }
});
document.getElementById('toggle-password').addEventListener('click', function() {
    var passwordInput = document.getElementById('employee-password-view');
    var icon = document.getElementById('toggle-password').querySelector('i');

    if (passwordInput.type === "password") {
      passwordInput.type = "text";
      icon.classList.remove('fa-eye');
      icon.classList.add('fa-eye-slash');
    } else {
      passwordInput.type = "password";
      icon.classList.remove('fa-eye-slash');
      icon.classList.add('fa-eye');
    }
  });
</script>
</body>
</html>
